<div id=D__ID module=app>
    <!-- special font, css etc for this app -->
    <link rel="stylesheet" href='https://fonts.googleapis.com/css?family=Nunito|Nunito+Sans|Roboto+Slab' />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins:300,400,500|Gaegu:700" />
    <!-------->
    <script main-code>














        //------------------------------------
        $vm.api_address="https://api.wappsystem.com";
        if(window.location.toString().indexOf('_p=1')!=-1) $vm.api_address="https://api.wappsystem.com:3000";
        //------------------------------------
        $vm.default_title="Modular distributed web application";
        //------------------------------------
        var ready1=function(){
            var set_layout=function(){
                $vm.min_height=$(window).height()-$('#header').outerHeight();
                $('#content').css('min-height',$vm.min_height);
                $('#content').css('padding-top',$('#header').outerHeight());
            }
            //------------------------------------
            set_layout();
            //-----------------------------------------
            $vm.show=function(m_name){
                var nm="";
                var ns=window.location.href.split('?/');
                if(ns.length>1) nm=ns[1].split('&')[0].replace('-data','').replace(/-/g,' ');
                document.title=$vm.default_title;
                if(nm!=""){
                    var name=nm.charAt(0).toUpperCase() + nm.slice(1)
                    document.title=name+" | "+$vm.default_title;
                }
                $("meta[name='description']").attr("content", "A single page application with shared reusable modules distributed on different static web servers around the world and maintained by different people with different skills!");
                $("body").removeClass();
                $("body").addClass('body_background_default');
                $vm.active_id=undefined;
                $vm.active_name=undefined;
                if(m_name!=undefined){ $vm.active_id=$vm.module_list[m_name].id; $vm.active_name=m_name; }
                if(m_name!=undefined && $vm.module_list[m_name].show!=undefined) $vm.module_list[m_name].show();
                if($vm.active_id!=undefined){
                    $('#D'+$vm.active_id).css('height','unset');
                    $('#D'+$vm.active_id).css('min-height',$vm.min_height+"px");
                    $('#D'+$vm.active_id).css('overflow','unset');
                    $('#D'+$vm.active_id).css('overflow-x','auto');
                }
                if(m_name=='home') $('#D'+$vm.active_id+">div.home_page_1").css('height',$vm.min_height+"px");
                if(m_name=='home') $("#header").css("background","rgba(0,0,0,0)");
                else $("#header").css("background","rgba(0,0,0,0.5)");
            }
            //------------------------------------
            window.onresize=function(){set_layout();}
            //------------------------------------
            $vm.init(function(){
                $vm.init_status=1;
                $vm.show_user();
            })
            //------------------------------------
            if($vm.first_module!=undefined) $vm.show($vm.first_module);
            //------------------------------------
        }
        //-------------------------------------
        var I=0; var loop_1=setInterval(function (){
            if($vm['header_ready']==1 && $vm['footer_ready']==1){  clearInterval(loop_1); ready1(); }
            I++; if(I>50){ clearInterval(loop_1); alert("header error."); }
        },100);
        //-------------------------------------
        $(window).on('scroll', function() {
            if($vm.active_name=='home'){
                var y=-$(window).scrollTop()/2;
                $('body').css({ 'background-position-y': y+'px'});
                var r=-y/300; if(r>0.5) r=0.5;
                $("#header").css("background","rgba(0,0,0,"+r+")");
            }
            if($vm.demo_scroll!=undefined) $vm.demo_scroll();
        });
        //-------------------------------------
        $vm.office365_init=function(){
            //------------------------------------
            $vm.o365={};
            $vm.o365.organizationURI = "https://vmiis.crm6.dynamics.com";
            $vm.o365.sharepointURI   = "https://vmiis.sharepoint.com";
            $vm.o365.tenant          = "vmiis.onmicrosoft.com";
            $vm.o365.clientId        = "82698c57-0152-44cb-ab2f-5c4a33064201";
            $vm.o365.pageUrl         = "http://127.0.0.1:8000/vmiis/online-profile/modules/v/vmiis-365-app/index.html";
            //------------------------------------
            var user, message, errorMessage, loginButton, logoutButton, getAccountsButton, accountsTable, accountsTableBody;  
            
            $vm.o365.endpoints = {  
                orgUri: $vm.o365.organizationURI,
                sharePointUri: $vm.o365.sharepointURI,  
            };
            $vm.o365.config = {  
                tenant: $vm.o365.tenant,  
                clientId: $vm.o365.clientId,  
                postLogoutRedirectUri: $vm.o365.pageUrl,  
                endpoints: $vm.o365.endpoints,  
                cacheLocation: 'localStorage', 
            };
            
            $vm.o365.authenticate=function() {  
                //OAuth context  
                $vm.o365.authContext=new AuthenticationContext($vm.o365.config);  
                // Check For & Handle Redirect From AAD After Login  
                var isCallback = $vm.o365.authContext.isCallback(window.location.hash);  
                if (isCallback) {  
                    $vm.o365.authContext.handleWindowCallback();  
                }  
                var loginError = $vm.o365.authContext.getLoginError();  

                if (isCallback && !loginError) {  
                    window.location = $vm.o365.authContext._getItem($vm.o365.authContext.CONSTANTS.STORAGE.LOGIN_REQUEST);  
                }  
                else {  
                    //errorMessage.textContent = loginError;  
                    //alert(loginError)
                }  
                $vm.o365.user=$vm.o365.authContext.getCachedUser();  
                if($vm.o365.user!=null){
                    $vm.user_name=$vm.o365.user.profile.given_name+' '+$vm.o365.user.profile.family_name;
                    $vm.show_user();
                }
            }  
            //------------------------------------
        }
    </script>
    <style main-style>
        html,body{ margin:0; padding:0; height:100%; font-family:Arial;}
        body{background-size: cover; background-repeat: repeat-x; background-position: center top; background-attachment: fixed;}
        .body_background_default{ background-image: url(https://images.unsplash.com/photo-1528458143920-803b929283b2?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1050&q=80);}
        /*
        body:before {
            background: #fff;
            position: absolute;
            content: "";
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            opacity: .4;
            z-index: -100;
        }
        */
    </style>
</div>
